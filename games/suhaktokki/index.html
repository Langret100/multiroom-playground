<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>ìˆ˜í•™í† ë¼</title>
  <style>
    :root{--bg:#0c1220;--panel:#121a2e;--line:rgba(255,255,255,.12);--txt:#f4f7ff;--muted:rgba(244,247,255,.72);--accent:#66e0a3;--danger:#ff5a7a;}
    *{box-sizing:border-box;touch-action:none;-webkit-user-select:none;user-select:none;}
    html,body{width:100%;height:100%;margin:0;overflow:hidden;background:radial-gradient(1200px 800px at 50% 10%,#1a2642,#0c1220);color:var(--txt);font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;}
    canvas{background:#0b0f1a;border-radius:16px;box-shadow:0 20px 80px rgba(0,0,0,.45);}

    /* HUD */
    #hud{position:fixed;left:0;top:0;right:0;pointer-events:none;display:flex;gap:8px;justify-content:space-between;align-items:flex-start;padding:10px;}
    #leftHud{display:flex;gap:8px;align-items:flex-start;pointer-events:none;}
    .pill{pointer-events:auto;background:rgba(18,26,46,.75);backdrop-filter:blur(8px);border:1px solid var(--line);border-radius:999px;padding:8px 12px;font-weight:800;font-size:13px;display:flex;gap:10px;align-items:center;}
    #roomPill{padding:7px 10px;font-size:12px;opacity:.9}
    .pill small{font-weight:800;color:var(--muted)}
    .bar{width:120px;height:10px;border-radius:999px;background:rgba(255,255,255,.12);overflow:hidden;border:1px solid rgba(255,255,255,.10)}
    .bar>i{display:block;height:100%;width:0%;background:linear-gradient(90deg,var(--accent),#7dd3fc);}
    #rightHud{display:flex;gap:8px;align-items:flex-start;}
    button.ui{pointer-events:auto;border:1px solid var(--line);background:rgba(18,26,46,.75);color:var(--txt);border-radius:12px;padding:10px 12px;font-weight:900;font-size:13px;cursor:pointer;}
    button.ui:active{transform:translateY(1px)}
    button.ui.mini{padding:7px 9px;border-radius:10px;font-size:12px;}
    button.ui.icon{width:30px;height:30px;padding:0;border-radius:12px;display:inline-flex;align-items:center;justify-content:center;font-size:14px;}

    /* Visibility helpers */
    #lobby.hidden{display:none;}
    .modal.show{display:flex;}

    /* Lobby */
    #lobby{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;padding:18px;}
    #lobbyCard{width:min(560px,92vw);background:rgba(18,26,46,.92);border:1px solid var(--line);border-radius:18px;padding:18px;box-shadow:0 30px 90px rgba(0,0,0,.55)}
    #title{font-size:28px;font-weight:900;letter-spacing:-.5px;display:flex;align-items:center;gap:10px;margin:0 0 6px;}
    #subtitle{margin:0 0 14px;color:var(--muted);font-weight:700;}
    #lobbyStatus{margin:0 0 10px;color:rgba(244,247,255,.82);font-weight:800;font-size:12px;line-height:1.35;}
    .row{display:flex;gap:10px;flex-wrap:wrap;}
    .field{flex:1;min-width:170px;display:flex;flex-direction:column;gap:6px;margin:10px 0;}
    label{font-size:12px;color:var(--muted);font-weight:800;}
    input{border:1px solid var(--line);background:rgba(255,255,255,.06);color:var(--txt);border-radius:12px;padding:12px 12px;font-size:14px;font-weight:800;outline:none;}
    #lobbyActions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;}
    .primary{background:linear-gradient(180deg,#66e0a3,#33c38a);border:0;color:#081022;}
    .danger{background:linear-gradient(180deg,#ff5a7a,#ff2f66);border:0;color:#1a0610;}
    .note{margin-top:10px;color:var(--muted);font-size:12px;line-height:1.35;}
    .tag{display:inline-block;padding:2px 8px;border-radius:999px;background:rgba(255,255,255,.10);border:1px solid rgba(255,255,255,.12);margin-right:6px;}

    /* Roster */
    #roster{margin-top:12px;padding:12px 12px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.10);border-radius:14px;}
    #rosterHead{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:10px;}
    #rosterHead b{font-size:13px;}
    #rosterMeta{font-size:12px;color:var(--muted);font-weight:800;}
    #rosterList{display:flex;flex-wrap:wrap;gap:8px;}
    .chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.12);background:rgba(18,26,46,.55);font-weight:900;font-size:12px;}
    .chip i{display:inline-block;width:10px;height:10px;border-radius:999px;background:rgba(255,255,255,.45);}
    .chip .bot{opacity:.85;font-weight:1000;color:rgba(125,211,252,.95)}

    /* Touch UI */
    #touchUI{position:fixed;inset:0;pointer-events:none;display:none;}
    #joy{position:absolute;left:14px;bottom:14px;width:140px;height:140px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.10);backdrop-filter:blur(6px);}
    #joyKnob{position:absolute;left:50%;top:50%;width:64px;height:64px;border-radius:999px;transform:translate(-50%,-50%);background:rgba(255,255,255,.10);border:1px solid rgba(255,255,255,.12);}
    #interactBtn,#killBtn,#saboBtnTouch,#forceBtnTouch{position:absolute;right:14px;width:140px;height:64px;border-radius:18px;display:flex;align-items:center;justify-content:center;font-weight:1000;font-size:16px;opacity:.35;pointer-events:none;}
    #interactBtn{bottom:18px;background:linear-gradient(180deg,#66e0a3,#33c38a);border:0;color:#071022;}
    #killBtn{bottom:92px;background:linear-gradient(180deg,#222,#000);border:1px solid rgba(255,255,255,.12);color:#fff;font-size:15px;}
    #saboBtnTouch{bottom:166px;background:linear-gradient(180deg,#3b82f6,#1d4ed8);border:1px solid rgba(255,255,255,.12);color:#fff;font-size:15px;}
    #forceBtnTouch{bottom:240px;background:linear-gradient(180deg,#a855f7,#7c3aed);border:1px solid rgba(255,255,255,.12);color:#fff;font-size:15px;}
    #interactBtn.ready,#killBtn.ready,#saboBtnTouch.ready,#forceBtnTouch.ready{opacity:1;pointer-events:auto;}

    /* Modals */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;padding:18px;}
    .sheet{width:min(560px,92vw);background:rgba(18,26,46,.92);border:1px solid var(--line);border-radius:18px;padding:16px;box-shadow:0 40px 110px rgba(0,0,0,.6);}
    .sheet h2{margin:0 0 6px;font-size:18px;}
    .sheet p{margin:0 0 12px;color:var(--muted);font-weight:700;}
    .divider{height:1px;background:rgba(255,255,255,.12);margin:12px 0;}
    .wide{width:100%;}

    /* Scene */
    #sceneCanvas{width:100%;height:210px;border-radius:14px;background:rgba(0,0,0,.22);border:1px solid rgba(255,255,255,.10);margin:8px 0 10px;}

    /* Map canvas inside modal */
    #mapUiCanvas{width:100%;height:420px;border-radius:14px;background:rgba(0,0,0,.22);border:1px solid rgba(255,255,255,.10);margin:8px 0 10px;}
    .legend{display:flex;flex-wrap:wrap;gap:10px;color:var(--muted);font-weight:800;font-size:12px;}
    .legend span{display:inline-flex;align-items:center;gap:6px;}
    .dot{width:10px;height:10px;border-radius:999px;background:rgba(255,255,255,.45);display:inline-block;}

    /* Canvas sizing */
    #wrap{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;}
  </style>
</head>
<body>
  <div id="wrap"><canvas id="gameCanvas" width="960" height="540"></canvas></div>

  <div id="hud" style="display:none">
    <div id="leftHud">
      <button class="ui icon" id="rulesBtn" title="ê²Œì„ ê·œì¹™">?</button>
      <div class="pill">
        <span>â±ï¸ <span id="timeText">03:00</span></span>
        <span class="bar" title="ë¯¸ì…˜ ì§„í–‰"><i id="progFill"></i></span>
        <small id="progText">0/8</small>
      </div>
    </div>
    <div id="rightHud">
      <div class="pill" id="rolePill" style="display:none"><span id="roleText"></span></div>
      <div class="pill" id="roomPill" style="display:none"><span id="roomText"></span></div>
      <button class="ui mini" id="mapBtn">ì§€ë„</button>
      <button class="ui mini" id="forceBtn" style="display:none">ê°•ì œë¯¸ì…˜</button>
      <button class="ui mini" id="saboBtn" style="display:none">ë¬¼ë§‰ê¸°</button>
      <button class="ui mini" id="fullscreenBtn">ì „ì²´í™”ë©´</button>
      <button class="ui mini" id="exitBtn">ë‚˜ê°€ê¸°</button>
    </div>
  </div>

  <div id="touchUI">
    <div id="joy"><div id="joyKnob"></div></div>
    <div id="interactBtn">ì¡°ì‘</div>
    <div id="killBtn">ê²€ì€ë‹¹ê·¼</div>
    <div id="forceBtnTouch">ê°•ì œë¯¸ì…˜</div>
    <div id="saboBtnTouch">ë¬¼ë§‰ê¸°</div>
  </div>

  <div id="lobby">
    <div id="lobbyCard">
      <h1 id="title">ğŸ° ìˆ˜í•™í† ë¼</h1>
      <p id="subtitle">1~8ëª… ì…ì¥ ê°€ëŠ¥ Â· 4ëª… ì´ìƒì´ë©´ ëŒ€ì „, 1~3ëª…ì€ ì—°ìŠµ ëª¨ë“œ(ì„ ìƒí† ë¼ ì—†ìŒ)</p>
      <p id="lobbyStatus">â€» íŒ: íŒŒì¼ ë”ë¸”í´ë¦­(file://)ë¡œëŠ” ì—ì…‹ ë¡œë”©ì´ ë§‰í˜€ìš”. <b>ë¡œì»¬ ì„œë²„</b>ë¡œ ì‹¤í–‰í•˜ì„¸ìš”. (ì˜ˆ: <code>python -m http.server 8000</code>)</p>

      <div class="row">
        <div class="field">
          <label>ë‹‰ë„¤ì„</label>
          <input id="nick" maxlength="10" placeholder="ì˜ˆ: ë‹¹ê·¼ì™•" />
        </div>
        <div class="field">
          <label>ë°© ì½”ë“œ</label>
          <input id="room" maxlength="8" placeholder="ì˜ˆ: 1234" />
        </div>
      </div>

      <div id="lobbyActions">
        <button class="ui primary" id="joinBtn">ë°© ì°¸ê°€ / ë§Œë“¤ê¸°</button>
        <button class="ui" id="addBotBtn">ë´‡ +1 (í…ŒìŠ¤íŠ¸)</button>
        <button class="ui danger" id="startBtn" disabled>ê²Œì„ ì‹œì‘ (í˜¸ìŠ¤íŠ¸)</button>
      </div>

      <div id="roster" style="display:none">
        <div id="rosterHead">
          <b>ëŒ€ê¸°ì‹¤</b>
          <span id="rosterMeta">0/8</span>
        </div>
        <div id="rosterList"></div>
      </div>

      <div class="note">
        <span class="tag">PC</span>ë§ˆìš°ìŠ¤ë¡œ ì´ë™(í´ë¦­/ë“œë˜ê·¸) Â· ê°€ê¹Œì´ì„œ <b>ì¡°ì‘</b><br/>
        <span class="tag">ëª¨ë°”ì¼</span>ì™¼ìª½ ì¡°ì´ìŠ¤í‹± Â· ì˜¤ë¥¸ìª½ <b>ì¡°ì‘</b> / (ì„ ìƒí† ë¼ë§Œ) <b>ê²€ì€ë‹¹ê·¼</b><br/>
        <span class="tag">íŒ</span>í‚¤ë³´ë“œ: <b>M</b>(ì§€ë„) Â· <b>Q</b>(ë¬¼ë§‰ê¸°) Â· <b>F</b>(ê°•ì œë¯¸ì…˜)
      </div>
    </div>
  </div>

  <div class="modal" id="missionModal">
    <div class="sheet">
      <h2 id="missionTitle">ë¯¸ì…˜</h2>
      <p id="missionDesc">ë¬¸ì œ 3ê°œë¥¼ ë§íˆë©´ í•´ê²°!</p>
      <div class="divider"></div>
      <div id="qArea"></div>
      <div class="divider"></div>
      <button class="ui wide" id="closeMission">ë‹«ê¸°</button>
    </div>
  </div>

  <div class="modal" id="meetingModal">
    <div class="sheet">
      <h2>íšŒì˜ Â· íˆ¬í‘œ</h2>
      <p id="meetingInfo">ëˆ„ê°€ ì„ ìƒí† ë¼ì¼ê¹Œ?</p>
      <div class="divider"></div>
      <div id="voteList"></div>
      <div class="divider"></div>
      <button class="ui wide" id="skipVote">ìŠ¤í‚µ</button>
    </div>
  </div>

  <div class="modal" id="sceneModal">
    <div class="sheet">
      <h2 id="sceneTitle">ì¶”ë°©</h2>
      <canvas id="sceneCanvas" width="520" height="210"></canvas>
      <p id="sceneText">...</p>
      <button class="ui wide" id="sceneOk">ê³„ì†</button>
    </div>
  </div>

  <!-- Rules modal -->
  <div class="modal" id="rulesModal">
    <div class="sheet">
      <h2>ê²Œì„ ê·œì¹™</h2>
      <p>ë¯¸ì…˜ì„ í•´ê²°í•´ ìˆ˜í•™í† ë¼(í¬ë£¨)ê°€ ìŠ¹ë¦¬í•˜ê±°ë‚˜, ì„ ìƒí† ë¼(ì„í¬ìŠ¤í„°)ê°€ ì‹œê°„ì„ 0ìœ¼ë¡œ ë§Œë“¤ë©´ ì„ ìƒí† ë¼ ìŠ¹ë¦¬!</p>
      <div class="divider"></div>
      <div style="color:rgba(244,247,255,.88);font-weight:800;font-size:13px;line-height:1.5">
        <div style="margin-bottom:8px"><b>ê¸°ë³¸</b><br/>- ê°€ê¹Œì´ì„œ <b>ì¡°ì‘</b>í•˜ë©´ ë¯¸ì…˜/ì‹œì„¤ ì‚¬ìš©<br/>- í™œì„± ë¯¸ì…˜ì€ ë°”ë‹¥ ë¶„ìˆ˜ì— <b>!</b> í‘œì‹œ</div>
        <div style="margin-bottom:8px"><b>ì˜¤ë‹µ í˜ë„í‹°(ëŒ€í‘œ)</b><br/>- ë‹¨ìœ„: 10ì´ˆ ë°©í–¥ ë°˜ì „<br/>- ëº„ì…ˆ: 8ì´ˆ ì‹œì•¼ ê°ì†Œ<br/>- ê·¸ë˜í”„: 7ì´ˆ ë¯¸ì…˜ ì ê¸ˆ(ìë™ ì¬ì˜¤í”ˆ)</div>
        <div style="margin-bottom:8px"><b>ì‹œê°„/ëˆ„ìˆ˜</b><br/>- ë¯¸ì…˜ ì œí•œì‹œê°„(60ì´ˆ) ì´ˆê³¼ ì‹œ ì‹¤íŒ¨ â†’ ì‹œê°„ ê°ì†Œ + ëˆ„ìˆ˜ í”ì <br/>- ëˆ„ìˆ˜ ë ˆë²¨ì´ ë†’ì„ìˆ˜ë¡ ì‹œê°„ì´ ë” ë¹¨ë¦¬ ì¤„ì–´ë“¦</div>
        <div><b>ì„ ìƒí† ë¼(4ëª… ì´ìƒ)</b><br/>- ê²€ì€ë‹¹ê·¼ìœ¼ë¡œ ë‹¤ìš´ ìœ ë„, ì‹ ê³ /ì¢…ìœ¼ë¡œ íšŒì˜, ë¬¼ë§‰ê¸° ì‚¬ë³´íƒ€ì£¼, ë•…êµ´ ì´ë™, ê°•ì œë¯¸ì…˜</div>
      </div>
      <div class="divider"></div>
      <button class="ui wide" id="closeRules">ë‹«ê¸°</button>
    </div>
  </div>

  <!-- Map modal -->
  <div class="modal" id="mapModal">
    <div class="sheet">
      <h2>ì§€ë„</h2>
      <p>ë¯¸ì…˜ ìœ„ì¹˜ì™€ ì§„í–‰ ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.</p>
      <canvas id="mapUiCanvas" width="520" height="420"></canvas>
      <div class="legend">
        <span><i class="dot" style="background:rgba(125,211,252,.95)"></i> í™œì„± ë¯¸ì…˜</span>
        <span><i class="dot" style="background:rgba(255,152,84,.95)"></i> í•´ê²°ë¨</span>
        <span><i class="dot" style="background:rgba(255,255,255,.85)"></i> ë‚´ ìœ„ì¹˜</span>
      </div>
      <div class="divider"></div>
      <button class="ui wide" id="closeMap">ë‹«ê¸°</button>
    </div>
  </div>

  <script>
    // Cloudflare Workersë¡œ ì˜¨ë¼ì¸ ì—°ë™í•  ë•Œ ì—¬ê¸°ì— wss ì£¼ì†Œë¥¼ ë„£ì–´ì¤˜ (ì˜ˆ: wss://your-domain.workers.dev)
    window.__ONLINE_WS_BASE__ = '';
  </script>
  <script src="game.js"></script>
</body>
</html>
