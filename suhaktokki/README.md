# 수학토끼 (Among Us 스타일 협동/추리)

이 게임은 **Multiroom(로비/방)** 안에서 실행되는 4~8인 협동 게임입니다.

- 기본 역할
  - **수학토끼(학생/크루)**: 미션(수학 문제) 해결로 제한시간을 늘리고 생존합니다.
  - **선생토끼(임포스터)**: 검은당근(처형) / 불 끄기 / 사보타지로 방해합니다.
- **1~3명**은 자동으로 **연습 모드**로 시작합니다(선생토끼 없음).

---

## 실행 방법 (다른 기기/브라우저에서도 정상)

### 1) 로컬(같은 PC/같은 네트워크) 테스트

1. 이 폴더가 있는 위치에서 로컬 서버를 띄우세요.
   ```bash
   cd multiroom
   python -m http.server 8000
   ```
2. 브라우저에서 `http://localhost:8000` 접속 → 로비에서 방 생성/입장
3. 같은 PC에서 여러 탭을 열어도 되고, **다른 기기/다른 브라우저**에서도 같은 방 코드를 입력해 접속하면 됩니다.

> `file://` 더블클릭 실행은 브라우저 보안 정책 때문에 에셋/네트워크가 깨질 수 있어요. 꼭 로컬 서버로 여세요.

### 2) 실제 멀티(여러 기기)로 쓰려면

`cf-worker/`(Cloudflare Workers + Durable Objects)가 백엔드입니다.

- 개발(dev):
  ```bash
  cd cf-worker
  wrangler dev
  ```
- 배포:
  ```bash
  cd cf-worker
  wrangler deploy
  ```

클라이언트는 `multiroom/js/core/config.js`의 기본 Worker 주소를 사용하거나,
HTML에서 다음처럼 덮어쓸 수 있습니다.

```html
<script>
  window.__SERVER_ENDPOINT__ = "wss://<your-worker-subdomain>.workers.dev";
  window.__SERVER_HTTP__ = "https://<your-worker-subdomain>.workers.dev";
</script>
```

---

## 조작

- PC: 마우스 클릭 이동 + `E`(상호작용)
- 모바일: 화면 터치/드래그(가상 조이스틱) + 상호작용 버튼(가까이 가면 표시)

가까운 상호작용 대상(문, 종, 미션, 램프 등)이 있으면 화면에 **큰 말풍선 UI**로 `열기/닫기`, `회의`, `미션` 등이 표시됩니다.

---

## 게임 진행

### 역할 공개(어몽어스처럼)
게임이 시작되면 화면 중앙에 역할 카드가 뜹니다.

- 수학토끼: “미션을 풀어 시간을 늘리자!”
- 선생토끼: “들키지 말고 검은당근으로 빵점을 줘!”
- 연습 모드: “1~3명일 때는 연습 모드”

> **선생토끼인 본인 화면에서만** 캐릭터 얼굴에 **뱅글이 안경 오버레이**가 보입니다(다른 유저 화면은 그대로).

### 미션 상호작용
- 미션 위치(바닥에 붙은 물 새는 구멍) 근처에서 상호작용하면 **수학 문제 UI**가 뜹니다.
- **미션 1개 = 문제 3개**를 맞히면 완료.
- 시간 내 해결 못하면 실패 처리(패널티 적용 + 제한시간 감소).

### 문(덩굴문)
- 방 입구(복도-방 경계)에 배치되며, 닫히면 **이동과 시야를 차단**합니다.
- 닫힌 문은 “타일 1개 막기”가 아니라 **경계(엣지) 차단** 방식이라, 보이는데 못 지나가는 ‘투명 벽’ 느낌이 줄어듭니다.

### 조명(램프)
- 맵에 **2종류 램프(floor/street)** 가 배치되어 있습니다.
- 선생토끼가 조명을 끌수록 크루 시야가 점점 어두워지고, 최종적으로는 **전방 부채꼴 시야**만 남습니다.
- 크루는 램프를 다시 켤 수 있습니다.

---

## 꾸밈(장식)

방/복도에 랜덤하지만 **결정적(deterministic)** 인 배치로 장식이 들어갑니다.
- 방마다 테이블/돌/램프 등의 조합이 달라서 “방마다 느낌이 다른” 상태가 됩니다.
- 장식이 충돌(이동 방해)을 만들 경우에는 해당 타일을 솔리드로 처리합니다.

---

## 참고
- 스프라이트는 PNG 그대로 사용합니다(영문 파일명으로 유지).
- 캐릭터 쓰러짐/빵점 표시/처형 모션(시야 안에서 보일 때만)은 코드로 처리됩니다.
  - 시야 밖에서 처형되어도, 기절/흔적은 남도록 처리됩니다.
